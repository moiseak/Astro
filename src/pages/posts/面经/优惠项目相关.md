---
layout: /src/layouts/MarkdownPostLayout.astro
title: 优惠项目相关
description: 优惠项目相关
pubDate: 2025-04-20
---

## 一人一单具体如何实现

本项目采用了 Redis+Lua脚本 、CAS、数据库唯一索引 实现一人一单，在用户发起秒杀请求时，首先通过Lua脚本在Redis中原子性判断该用户是否已经下过单（利用 SISMEMBER 判断用户ID是否存在于订单集合中），如果存在则直接返回，防止重复下单。在消息队列消费者（ `receiveSeckillMessage` ）中，落库前再次通过数据库查询是否已存在该用户的订单，防止极端情况下的重复下单。数据库层面在订单表（如 tb_voucher_order ）设置了 (user_id, voucher_id) 唯一索引，作为最终防线。

## 如何保证数据一致性

 使用 Cache Aside 策略，先更新数据库，再删除缓存